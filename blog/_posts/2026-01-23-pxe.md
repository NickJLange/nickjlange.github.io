---
layout: default
title: PXE Booting with UEFI shouldn't be so hard
date: 2026-01-23
---

## Introduction

Itâ€™s been a few years since I bought a nonâ€‘Apple, nonâ€‘IoT device. Enter the Z2 Mini G1a, snagged on Black Friday and finally delivered last week. One reason I went HP (think AppleCare) is the warranty. HP also ships something called Wolf Security ğŸº (no idea what it really does), so instead of poking at that, I decided to wipe the preâ€‘installed Ubuntu OS. UEFI USB Boot Failed  - how about PXE? 

This should be simple, right? My AI buddy can whip up a PXE server in secondsâ€¦ right? ğŸ¤–

**FAIL**

Repo: https://github.com/NickJLange/pxe-server

### Lessons Learned ğŸ§ 
- HP â€œiLOâ€ wasnâ€™t what I paid $50 for â€” so that was fun
- USB UEFI boot sticks are not as easy as they sound
- Passing broadcast packets from `src_net` to a container *while preserving the MAC address* is tricky  
  - Thought `--net=host` would solve it. It didnâ€™t.
- Rootless containers + dnsmasq for TFTP = ğŸš«  
  - Port 69 is hardâ€‘coded for TFTP  
  - **Implication:** donâ€™t use dnsmasq for TFTP
- Donâ€™t let the AI buddy build the PXE server for you  
  - Fancy ideas like â€œdownload ISO on demandâ€ wasted time  
  - Just grab `netboot.tar.gz` for Ubuntu and move on
- TFTP is **slow** ğŸ¢

### New Things Learned ğŸ§©
- `nft ip mangle`
- TFTP packet size throttling
- More dnsmasq surprises ğŸ™ƒ

If I had more time, Iâ€™d split dnsmasq into two instances:
- One for DHCP, using `--net=host` to avoid IP mangling headaches
- One for TFTP, just to remap the privileged port

## Server BOM 
- Ubuntu Linux 24.04
- HP Z2 Mini G1a w/AMD Ryzenâ„¢ AI Max+ PRO 395 (3 GHz w/up to 5.1 GHz w/Boost, 16 core), Radeon 8060S Graphics + 128 GB memory
- ENERGY STAR Qualified Configuration
- Operating System Load to M.2
- 1 TB HP Z Turbo PCIe 4x4 M.2 TLC SSD
- 1 TB HP Z Turbo PCIe 4x4 M.2 TLC 2nd SSD
- RAID 0 Striped Array Configuration
- HP 2.5GbE Flex Port
- No Included Keyboard
- No Included Mouse
- 300W Z2 Mini EPA92 Power Supply
- C13 Flange Premium CWP Black Straight Desktop Workstations Power Cord US
- No Adapters Needed
- OS Localization
- 1/1/1 DM Label US
- Mediatek MT7925 Wi-Fi 7 +Bluetooth 5.4 AIM-T WW WLAN
- Compliant with TCO Certified
- No Country of Origin Restriction
- One-year (1/1/1) limited warranty
- (WKS Mini) Single Unit Packaging
- Z2 G1a Mini Country Kit U
